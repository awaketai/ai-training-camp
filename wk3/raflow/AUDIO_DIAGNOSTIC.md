# 音频诊断指南

## 🔍 发现

**你的MacBook Pro麦克风是单声道（1个输入通道）**

这意味着：
- ✅ 不存在立体声转单声道的相位抵消问题
- ✅ 音频信号不会因为通道混合而损失

## 📊 新增的诊断功能

代码已更新，现在会每2秒输出一次单声道音频分析：

```
🎤 Mono Audio Analysis [packet #100]:
  RMS: 0.123456 | Peak: 0.456789
  ✅ Normal signal level
```

### 指标说明

1. **RMS (均方根)**: 音频平均能量
   - < 0.001: 信号太弱（需要大声说话或提高麦克风音量）
   - 0.01-0.3: 正常范围 ✅
   - > 0.3: 信号很强（很好）
   - > 0.5: 可能太响（但通常OK）

2. **Peak (峰值)**: 最大音频幅度
   - > 0.95: **削波警告！** 需要降低麦克风音量
   - 0.5-0.9: 正常范围 ✅
   - < 0.1: 信号偏弱

### 理想范围

- **RMS**: 0.05 - 0.3
- **Peak**: 0.3 - 0.8

## 🚀 如何测试

### 1. 停止当前运行的应用

如果应用正在运行，先按 `Ctrl+C` 停止。

### 2. 重新启动应用

```bash
cd /Users/admin/www/geek-ai-train/wk3/raflow
./start.sh
```

### 3. 开始录音

1. 在应用中点击"开始转写"按钮
2. 对着麦克风持续说话 10-20秒
3. 观察终端输出

### 4. 查看诊断日志

你应该看到类似这样的输出：

```
🎤 Mono Audio Analysis [packet #100]:
  RMS: 0.123456 | Peak: 0.456789
  ✅ Normal signal level

🎤 Mono Audio Analysis [packet #200]:
  RMS: 0.234567 | Peak: 0.567890
  ✅ Strong signal level (good)
```

## 📋 诊断清单

### 如果看到 "⚠️ WARNING: Signal too weak"
- [ ] 靠近麦克风说话
- [ ] 大声清晰地说话
- [ ] 检查系统设置 → 声音 → 输入 → 输入音量

### 如果看到 "⚠️ WARNING: Signal clipping"
- [ ] 降低系统麦克风音量
- [ ] 离麦克风远一点
- [ ] 说话声音适中

### 如果根本看不到 "🎤 Mono Audio Analysis"
- [ ] 确认已重新启动应用（不是热重载）
- [ ] 确认点击了"开始转写"按钮
- [ ] 检查终端是否有其他错误信息

## 🎯 结论

**立体声转单声道相位抵消问题：已排除 ✅**

你的麦克风是单声道，不存在这个问题。

如果识别率仍然很低，需要检查其他问题：
1. 音频输入电平（通过这个诊断检查）
2. VAD参数配置
3. 语言检测设置
4. 环境噪声

## 下一步

运行测试后，把看到的日志输出发给我，我会：
1. 判断音频电平是否合理
2. 确认是否存在削波或信号过弱
3. 继续排查其他可能导致识别率低的问题
